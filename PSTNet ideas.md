# Ideas for PSTNet
跟谁比：DeepSTN+  
### DeepSTN+的contributes：

#### idea1:捕获区域间的空间依赖，long range spatial dependence, 用ResPLUS来代替原来的ResUnits，ResPlus 包含了一个 ConvPlus 结构，可以捕获人流间的大范围空间依赖。

#### idea2:区域属性的影响。用了SemanticPlus ，就是early fusion+multi-fusion，提升区域属性的表达。

#### idea3:2datasets，5baselines，mae，mse减少8-13%

因此
#### Re1：PSConv（暂时这个名字）研究一下，周期性的dilated rate for conv，通过将CPT的conv变为PSConv，dilated 可以有效提升感受野，提升远距离客流运动特征的关联性


#### Re2：外部特征的spatial encoding + CPT 各自PSConv卷积之后的early concate，提升外部因素的空间关联性，增强区域属性特征。

#### Re3：NAS FPN + adjustment，首先不是检测任务，需要调整搜索空间，输出为同样分辨率的网格图，所以是单特征图（P5，或者是）作为输出。其次，pruning和repeat，按照effi中的来。

###### 提法：
为什么NAS？因为NAS经提出已被证明可以明显提升网络性能，在原生特征提取网络的分类任务、检测任务和其他已经取得了显著的成绩，因此在st prediction方面，也需要借鉴一下先进的思想。（加在introduction后边，引NAS）  
为什么NAS FPN？因为NAS全局太expensive，多尺度特征融合是重点，传统的FPN不够高效，NAS后的FPN不仅精度高，经过pruning+repeat之后还相对cheap。  


# 原文
### Prior Pyramid
根据【deepst】，作者采用了基于resnet结构的ResUnit分别去提取客流的邻近性、周期性和趋势性特征，融合了不同时间信息的深层特征。然而由于卷积方式相对固定，导致不同层特征之间的依赖局限于相邻空间之内，忽略了长距离空间特征的关联。  
感受野是代表特征提取网络提取空间特征广度的概念之一，随着感受野的提升，网络提取空间信息的依赖的能力也增加。提升感受野的方法有：  
1.提升卷积核的尺寸，通过改变卷积核的尺寸K来调整输入和输出层之间的特征映射区域。但扩张卷积核会引起网络参数量迅速增长，不是一个高效的方案。  
2.使用dilated conv，空洞卷积的方式【引用】可以提升卷积层的感受野的同时，不引入额外的参数量。然而由于dilated conv 的卷积方式，导致许多邻近特征提取不充分，使得丢失部分邻近客流特征的依赖和相关性，反而可能引起预测精度的drop。  
根据最新的研究，ab等人【引用】提出了一种新颖的卷积方式，通过周期性地调整卷积核的扩张比例，有效改善了普通diaconv感受野的局限性。如图2所示，输入为H x W的特征图，当使用Cout个K x K的卷积核对其进行特征提取时，每个卷积核的扩张比例将呈周期性变化。  
当k=3，扩张周期=3时，卷积核的感受野会周期性地变为3\5\7.因此同一个卷积核在一层卷积操作过程当中可以提取到不同空间特征的依赖，使网络不仅可以学习到近处的信息，还能获取到较远特征的关联。According to【psconv】，周期扩张可以轻松地应用在普通的卷积操作上，通过改变卷积方式来获得多尺度特征的表达，而不引入额外的参数与计算复杂度。  
本文对输入的客流分布网格图进行不同尺度的卷积，作为客流预测框架的先验金字塔结构。psconv以不同尺度的卷积核提取特征，形成了局部feature pyramid的结构，提取了丰富的邻近、周期和趋势信息的多尺度空间特征，有效提升了广域时空特征关联能力。  

### Preliminary feature aggregation
除客流的时空信息之外，代表城市自然环境状态的一些信息也会对客流的分布和运动规律造成一定的影响。在客流预测数据集TaxiBJ和BikeNYC中，这类影响因素被统计为按时间索引的外部因素向量。由于统计手段有限，这些外部因素不能准确反映空间位置信息，如  
天气：局部地区的降雨，或者根据风向判断降雨的轨迹，一定程度上影响了区域化的客流分布。  
节日：每逢节日期间，城市内一些景点、商场、客运站或交通枢纽的客流明显增加。  
因此一种空间编码的方式被引入，公式3  
Eij=spatial encoding（et1,et2，。。。，etn）  
其中se代表空间编码，eti代表某日期的外部因素向量。具体地，首先对外部因素的种类分类，针对大面积外部因素特征如天气因素，使用区域初始化，对小区域外部因素特征进行离散初始化。  
将外部因素构成与时空特征相同尺度的特征图，分别与代表邻近、周期和趋势的特征图进行ele-wise相加，将外部因素融合在时空信息中。  
在此之后，经过一层psconv，不同时间范围的特征图也将被融合，融合后的特征图表示为公式4  
HFM = λcp（C+ E）+λcp p（P+ E）+λep（ T + E ）  
其中λ分别代表相加的权重，p（）代表PSConv，CPT代表经过一些psconv特征提取的特征图，E为公式3所得。  
通过多元特征融合的方式，使得时空特征以及区域属性特征的表达得到了很大程度上的提升。  

### Post pyramid
a



### Contribution
使用一种新颖的卷积方式提取图像上的多尺度特征，提升不同空间距离的特征依赖，作为prior pyramid结构；其次利用空间编码将代表外部因素的向量映射在空间特征图上，最后
